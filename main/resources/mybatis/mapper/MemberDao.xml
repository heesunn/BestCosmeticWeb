<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.springboot.member.dao.MemberDao">
    <insert id="join">
        insert into bc_member
            (bcm_num , bcm_id , bcm_pw , bcm_name , bcm_email, bcm_googleid, bcm_naverid, bcm_kakaoid, bcm_facebookid,
             bcm_zipcode,bcm_address1,bcm_address2,bcm_address3,bcm_address4,bcm_phonenum1,bcm_phonenum2,bcm_phonenum3,
             bcm_authority,bcm_enable,bcm_joined_on,bcm_stopdate)
            values ( bcm_num_seq.nextval , #{param1} , #{param2} , #{param3} , #{param4} , '', '','','','','','','','','','',
                    '','role_user','true',sysdate,sysdate)
    </insert>
    <select id="userCheck" resultType="com.study.springboot.member.dto.MemberDto">
        select * from bc_member where bcm_id = #{param1}
    </select>
    <select id="selectUser" resultType="com.study.springboot.member.dto.MemberDto">
        select * from bc_member where bcm_num = #{param1}
    </select>
    <select id="orderDeliveryView" resultType="com.study.springboot.member.dto.OrderDeliveryDto">
        <!--select * from bc_order_history where bcm_num = #{param1}-->
        <!--order by는 현재 주문번호로 해놨는데 원래는 주문시간으로 order by 해야함 시간순으로 하면 스크립트실행 때 같은 시간으로 들어가서 페이징 문제생김-->
        select * from (select rownum num, A.* from
                      (select * from bc_order_history where bcm_num = #{param1}
                                and bco_order_status = '배송준비중'
                                or bco_order_status = '배송중'
                                or bco_order_status = '배송완료'
                                or bco_order_status = '구매확정'
                                order by bco_ordernum desc ) A
                                where rownum &lt;= #{param2} ) B where B.num &gt;= #{param3}
    </select>
    <select id="articlePage" resultType="_int">
        select count(*) as total from bc_order_history where bco_order_status = '배송준비중'
                                                       or bco_order_status = '배송중'
                                                       or bco_order_status = '배송완료'
                                                       or bco_order_status = '구매확정'
    </select>
    <update id="cancellationRequest">
        update bc_order_history set bco_order_status = '취소신청', bco_statusdate = sysdate
                                where bcm_num = #{param1} and bco_ordernum = #{param2}
    </update>
    <update id="exchangeRequest">
        update bc_order_history set bco_order_status = '교환신청', bco_statusdate = sysdate
                                where bcm_num = #{param1} and bco_ordernum = #{param2}
    </update>
    <update id="refundRequest">
        update bc_order_history set bco_order_status = '반품신청', bco_statusdate = sysdate
                                where bcm_num = #{param1} and bco_ordernum = #{param2}
    </update>
    <update id="purchaseConfirmation">
        update bc_order_history set bco_order_status = '구매확정', bco_statusdate = sysdate
                                where bcm_num = #{param1} and bco_ordernum = #{param2}
    </update>
    <select id="cancelExchangeRefund" resultType="com.study.springboot.member.dto.OrderDeliveryDto">
        <!--현재 order by 주문번호인데 나중에 상태변화날짜로 바꿔줄것-->
        select * from (select rownum num, A.* from
        (select * from bc_order_history where bcm_num = #{param1}
                    and bco_order_status = '취소신청'
                    or bco_order_status = '취소완료'
                    or bco_order_status = '교환신청'
                    or bco_order_status = '교환상품회수중'
                    or bco_order_status = '교환완료'
                    or bco_order_status = '반품신청'
                    or bco_order_status = '반품회수중'
                    or bco_order_status = '반품완료'
                    order by bco_ordernum desc ) A
                    where rownum &lt;= #{param2} ) B where B.num &gt;= #{param3}
    </select>
    <select id="articlePage2" resultType="_int">
        select count(*) as total from bc_order_history where bco_order_status = '취소신청'
                                                          or bco_order_status = '취소완료'
                                                          or bco_order_status = '교환신청'
                                                          or bco_order_status = '교환상품회수중'
                                                          or bco_order_status = '교환완료'
                                                          or bco_order_status = '반품신청'
                                                          or bco_order_status = '반품회수중'
                                                          or bco_order_status = '반품완료'
    </select>
</mapper>

<!--
1.sql 문 뒤에 세미콜론 절대 들어가면 안된다.
2.여기서 사용한 컬럼명으로 DTO(Value Object)의 필드명을 만들어야 한다.
3.select a.dno, b.dno 등의 경우 컬럼명에 alias를 사용하지 않으면 문제가 생김
4.ResultMap vs VO : VO가 더 빠르다.
    "iBatis 개발진에서 VO을 권장한다.
    왜냐하면 Map은 (iBatis에서 ) 수치상 훨씬 느리다고 한다.
 -->